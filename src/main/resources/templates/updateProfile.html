<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Profile</title>
    <link rel="stylesheet" th:href="@{/css/output.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body class="min-h-screen w-screen bg-white">

    <div th:replace="fragment/navbar :: navbar"></div>

    <div class="pt-16 pb-20">
        <div class="px-4 sm:px-6 lg:px-8 py-4">
            <div class="text-neutral">
                <a th:href="@{/user/my-profile}"
                    class="inline-flex items-center gap-2 mb-4 text-sm font-medium text-neutral hover:text-primary transition-colors group">
                    <div
                        class="w-9 h-9 rounded-full border border-neutral group-hover:border-primary flex items-center justify-center transition-all group-hover:scale-110">
                        <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7" />
                        </svg>
                    </div>
                    <span class="text-base sm:text-lg" th:text="@{'kembali ke profil'}"></span>
                </a>
            </div>
        </div>
        <main class="max-w-3xl lg:max-w-4xl mx-auto px-4 py-8 md:py-10">
            <form th:object="${formRequest}" th:action="@{/user/update-my-profile}" method="post"
                enctype="multipart/form-data" id="updateForm">

                <div class="mb-6 text-center">
                    <h1 class="text-3xl font-bold text-neutral mb-2">Perbarui Profil Anda</h1>
                    <p class="text-neutral-500">Kelola informasi akun dan foto profil Anda.</p>
                    <div class="divider"></div>
                </div>

                <div class="bg-white rounded-3xl shadow-xl p-6 mb-8 border border-neutral-100">
                    <div class="flex flex-col items-center">
                        <div class="relative group">
                            <div
                                class="w-32 h-32 rounded-full border-4 border-neutral-200 shadow-xl overflow-hidden transition-all duration-300 group-hover:border-neutral-400 group-hover:shadow-2xl">
                                <img id="previewImg"
                                    th:src="@{${#strings.isEmpty(formRequest.profilePicture) ? '/img/default.jpg' : '/uploads/' + formRequest.profilePicture}}"
                                    alt="Foto Profil"
                                    class="object-cover w-full h-full transition-transform duration-300 group-hover:scale-110" />
                            </div>

                            <label
                                class="absolute bottom-0 right-0 btn btn-circle btn-sm btn-neutral border-4 border-white shadow-lg cursor-pointer transition-transform duration-200 hover:scale-110">
                                <i class="fa-solid fa-camera text-sm"></i>
                                <input type="file" th:field="*{profilePicture}" id="profilePictureInput"
                                    accept="image/*" class="hidden" />
                            </label>
                        </div>

                        <p class="text-sm text-neutral-500 mt-4 text-center">
                            <i class="fa-solid fa-circle-info mr-1"></i>
                            Klik ikon kamera untuk mengubah foto
                        </p>
                        <p th:if="${validationErrors != null and #maps.containsKey(validationErrors, 'profilePicture')}"
                            th:text="${validationErrors.profilePicture}"
                            class="label-text-alt text-error mt-2 flex items-center gap-1">
                            <i class="fa-solid fa-circle-exclamation"></i>
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-3xl shadow-xl p-6 space-y-5 border border-neutral-100">

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold text-neutral flex items-center gap-2">
                                <i class="fa-solid fa-user text-neutral-400"></i>
                                Username
                            </span>
                        </label>
                        <input type="text" th:field="*{username}" placeholder="Masukkan username"
                            class="input input-bordered w-full bg-neutral-50 border-neutral-200 text-neutral placeholder:text-neutral-400 focus:bg-white focus:border-neutral-400 focus:outline-none transition-all duration-200" />
                        <p th:if="${validationErrors != null and #maps.containsKey(validationErrors, 'username')}"
                            th:text="${validationErrors.username}"
                            class="label-text-alt text-error mt-1 flex items-center gap-1">
                            <i class="fa-solid fa-circle-exclamation"></i>
                        </p>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold text-neutral flex items-center gap-2">
                                <i class="fa-solid fa-envelope text-neutral-400"></i>
                                Email
                            </span>
                        </label>
                        <input type="email" th:field="*{email}" placeholder="Masukkan email"
                            class="input input-bordered w-full bg-neutral-50 border-neutral-200 text-neutral placeholder:text-neutral-400 focus:bg-white focus:border-neutral-400 focus:outline-none transition-all duration-200" />
                        <p th:if="${validationErrors != null and #maps.containsKey(validationErrors, 'email')}"
                            th:text="${validationErrors.email}"
                            class="label-text-alt text-error mt-1 flex items-center gap-1">
                            <i class="fa-solid fa-circle-exclamation"></i>
                        </p>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold text-neutral flex items-center gap-2">
                                <i class="fa-solid fa-id-card text-neutral-400"></i>
                                Nama Lengkap
                            </span>
                        </label>
                        <input type="text" th:field="*{fullName}" placeholder="Masukkan nama lengkap"
                            class="input input-bordered w-full bg-neutral-50 border-neutral-200 text-neutral placeholder:text-neutral-400 focus:bg-white focus:border-neutral-400 focus:outline-none transition-all duration-200" />
                        <p th:if="${validationErrors != null and #maps.containsKey(validationErrors, 'fullName')}"
                            th:text="${validationErrors.fullName}"
                            class="label-text-alt text-error mt-1 flex items-center gap-1">
                            <i class="fa-solid fa-circle-exclamation"></i>
                        </p>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold text-neutral flex items-center gap-2">
                                <i class="fa-solid fa-phone text-neutral-400"></i>
                                Nomor Telepon
                            </span>
                        </label>
                        <input type="text" th:field="*{phoneNumber}" placeholder="Contoh: 081234567890"
                            class="input input-bordered w-full bg-neutral-50 border-neutral-200 text-neutral placeholder:text-neutral-400 focus:bg-white focus:border-neutral-400 focus:outline-none transition-all duration-200" />
                        <label class="label">
                            <span class="label-text-alt text-neutral-400">
                                <i class="fa-solid fa-circle-info text-xs mr-1"></i>
                                Opsional
                            </span>
                        </label>
                    </div>

                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold text-neutral flex items-center gap-2">
                                <i class="fa-solid fa-venus-mars text-neutral-400"></i>
                                Jenis Kelamin
                            </span>
                        </label>
                        <select th:field="*{gender}"
                            class="select select-bordered w-full bg-neutral-50 border-neutral-200 text-neutral placeholder:text-neutral-400 focus:bg-white focus:border-neutral-400 focus:outline-none transition-all duration-200">
                            <option value="" disabled selected>Pilih jenis kelamin</option>
                            <option th:each="g : ${genders}" th:value="${g}" th:text="${g}">
                            </option>
                        </select>
                    </div>

                </div>

                <div class="mt-8 pb-6">
                    <button type="submit"
                        class="btn btn-neutral w-full shadow-xl hover:shadow-2xl transition-all duration-200 h-14 text-base font-semibold">
                        <i class="fa-solid fa-floppy-disk text-lg"></i>
                        Simpan Perubahan
                    </button>
                </div>

            </form>
        </main>

    </div>
    <!-- Header dengan back button -->

    <div th:replace="fragment/navbar:: bottombar('profile')"></div>

    <script>
        // Preview image saat pilih file dengan animasi
        const profileInput = document.getElementById('profilePictureInput');
        const previewImg = document.getElementById('previewImg');

        profileInput.addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validasi tipe file
            if (!file.type.startsWith('image/')) {
                alert('File harus berupa gambar!');
                return;
            }

            // Validasi ukuran file (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                // Fade effect saat ganti gambar
                previewImg.style.opacity = '0';
                setTimeout(() => {
                    previewImg.src = e.target.result;
                    previewImg.style.opacity = '1';
                }, 150);
            };
            reader.readAsDataURL(file);
        });

        // Smooth transition untuk opacity
        previewImg.style.transition = 'opacity 0.3s ease';
    </script>
</body>

</html>